# Bootstrap configuration.

# Copyright (C) 2006-2013 Free Software Foundation, Inc.

# Modifications for GNU Datamash are
# Copyright (C) 2014-2015 Assaf Gordon <assafgordon@gmail.com>

# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3 of the License, or
# (at your option) any later version.

# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#

# gnulib modules used by this package.
gnulib_modules="
    announce-gen
    assert
    base64
    calloc-gnu
    c-ctype
    closeout
    configmake
    crypto/sha1
    crypto/sha256
    crypto/sha512
    crypto/md5
    dirname
    do-release-commit-and-tag
    error
    expl
    extensions
    fabsl
    fdl
    gendocs
    getopt-gnu
    gettext
    gitlog-to-changelog
    git-version-gen
    gnupload
    gnu-web-doc-update
    hard-locale
    hash
    hash-pjw
    ignore-value
    inttypes
    intprops
    inttostr
    isblank
    linebuffer
    locale
    localeconv
    maintainer-makefile
    mbsrtowcs
    minmax
    isnanl
    non-recursive-gnulib-prefix-hack
    progname
    propername
    random
    readme-release
    realloc-gnu
    size_max
    sqrtl
    stdint
    stdnoreturn
    strsep
    unlocked-io
    version-etc
    warnings
    xalloc
    xstrndup
    xstrtol
    xstrtoumax
"

# Additional xgettext options to use.  Use "\\\newline" to break lines.
XGETTEXT_OPTIONS=$XGETTEXT_OPTIONS'\\\
 --from-code=UTF-8\\\
 --flag=asprintf:2:c-format --flag=vasprintf:2:c-format\\\
 --flag=asnprintf:3:c-format --flag=vasnprintf:3:c-format\\\
 --flag=wrapf:1:c-format\\\
'

# If "AM_GNU_GETTEXT(external" or "AM_GNU_GETTEXT([external]"
# appears in configure.ac, exclude some unnecessary files.
# Without grep's -E option (not portable enough, pre-configure),
# the following test is ugly.  Also, this depends on the existence
# of configure.ac, not the obsolescent-named configure.in.  But if
# you're using this infrastructure, you should care about such things.

gettext_external=0
grep '^[	 ]*AM_GNU_GETTEXT(external\>' configure.ac > /dev/null &&
  gettext_external=1
grep '^[	 ]*AM_GNU_GETTEXT(\[external\]' configure.ac > /dev/null &&
  gettext_external=1

if test $gettext_external = 1; then
  # Gettext supplies these files, but we don't need them since
  # we don't have an intl subdirectory.
  excluded_files='
      m4/glibc2.m4
      m4/intdiv0.m4
      m4/lcmessage.m4
      m4/lock.m4
      m4/printf-posix.m4
      m4/size_max.m4
      m4/uintmax_t.m4
      m4/ulonglong.m4
      m4/visibility.m4
      m4/xsize.m4
  '
fi

gnulib_tool_option_extras="--makefile-name=gnulib.mk"

# Build prerequisites
buildreq="\
autoconf   2.62
automake   1.11.1
autopoint  0.19.4
git        1.5.5
gettext    0.19.4
gperf      -
gzip       -
makeinfo   -
perl       5.8
tar        -
"

bootstrap_post_import_hook ()
{
  # Automake requires that ChangeLog exist.
  touch ChangeLog || return 1
  # Massage lib/gnulib.mk before using it later in the bootstrapping process.
  build-aux/prefix-gnulib-mk --lib-name=$gnulib_name lib/$gnulib_mk
}

# File that should exist in the top directory of a checked out hierarchy,
# but not in a distribution tarball.
checkout_only_file=HACKING.md
